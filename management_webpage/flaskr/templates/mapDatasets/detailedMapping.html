{% extends 'base.html' %}

{% block content %}
<div class="container">
  <p class="mb-0"><strong>Dataset Name:</strong> {{chosenMapping[0][2]}}</p>
  <p class="mb-0"><strong>Dataset Uri:</strong> <a href="{{chosenMapping[0][3]}}">{{chosenMapping[0][3]}}</a></p>
  <p class="mb-0"><strong>Statistical Metadata:</strong></p>
  {% if categoricalCheck == true %}
  <table>
      <tr>
          <th> Categorical Value </th>
          <th> Cell values normalised </th>
          <th> Cell value mapping </th>
      </tr>
      {% for index, row in metadata.iterrows() %}
      <tr>
          <th> {{ row[0] | safe }} </th>
          <th> {{ row[1] | safe }} </th>
          <th>
              <select name="targetValues" smethod="GET"
                                          action="/getTargetValues">
                  {% for value in targetValues %}
                  <option value="{{ value }}" SELECTED> {{ value }}</option>
                  {% endfor %}
              </select>
	      <button class="btn btn-primary" type="submit">
		      Change
	      </button>
          </th>
      </tr>
      {% endfor %}
  </table>
  {% else %}
  {{ metadata | safe }}
  {% endif %}
  <!--{{ metadata | safe }}-->
  {% if chosenMapping[0][1] is not sameas chosenMapping[0][0] %}
  <div class="mt-3">
    <p class="mb-0"><strong>CDM Name:</strong> {{chosenMapping[0][1]}}</p>
    <p class="mb-0"><strong>CDM Uri:</strong> <a href="{{chosenMapping[0][0]}}">{{chosenMapping[0][0]}}</a></p>
  </div>
  {% endif %}

  <form class="mt-4" method="POST" action="{{ url_for('mapDatasets.submitForm') }}">
    <div>
      Nieuwe mapping kiezen:
      <div class="d-flex w-50">
        <select class="form-select me-1" name="cdmValues" aria-label="Default select example">
          {% for cdmValue in cdmValues %}
          <option value="{{chosenMapping[0][3]}},{{chosenMapping[0][0]}},{{cdmValue[0]}}" {% if chosenMapping[0][1] == cdmValue[1] %} SELECTED {% endif %}>{{cdmValue[1]}}</option>
          {% endfor %}
        </select>
        <button class="btn btn-primary" type="submit">
          {% if chosenMapping[0][1] is sameas chosenMapping[0][0] %}
          Add
          {% else %}
          Change
          {% endif %}
        </button>
      </div>
    </div>
  </form>

  {% if chosenMapping[0][1] is not sameas chosenMapping[0][0] %}
  <form action="/deletemapping" method="POST">
    <div>
      <button class="btn btn-danger" type="submit" name="delete"
        value={{chosenMapping[0][3]}},{{chosenMapping[0][0]}}>Delete Mapping</button>
    </div>
  </form>
  {% endif %}
</div>
{% endblock %}

{% block scripts %}
<script>
  const table = document.getElementsByClassName('dataframe')[0]
  console.log(table)
  table.classList.add('table', 'table-striped', 'w-25')
</script>
{% endblock %}
