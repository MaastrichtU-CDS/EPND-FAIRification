@prefix _: <http://example/#> .
@prefix dash: <http://datashapes.org/dash#> .
@prefix rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> .
@prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#> .
@prefix sh: <http://www.w3.org/ns/shacl#> .
@prefix xsd: <http://www.w3.org/2001/XMLSchema#> .
@prefix sio: <http://semanticscience.org/resource/>.
@prefix snomed: <http://purl.bioontology.org/ontology/SNOMEDCT/>.
@prefix UO: <http://purl.obolibrary.org/obo/>.
@prefix sty: <http://purl.bioontology.org/ontology/STY/>.

sio:SIO_000137 rdfs:label "category".
sio:SIO_000915 rdfs:label "numeric scale".
sio:SIO_000221 rdfs:label "has unit".
sio:SIO_000300 rdfs:label "has value".
sio:SIO_000223 rdfs:label "has property".

sty:T016 rdfs:label "Human".

_:PersonShape
    a sh:NodeShape ;
    sh:targetClass sty:T016;
    sh:property [
        sh:path rdf:type ;
        sh:hasValue sty:T016 ;
    ];
    sh:property [
        sh:path sio:SIO_000223;
        sh:node _:GenderShape ;
        sh:minCount 1;
    ] ;
    sh:property [
        sh:path sio:SIO_000223 ;
        sh:node _:AgeDiagnosisShape ;
        sh:minCount 1;
        sh:maxCount 1;
    ].

################################################
# Defining age at diagnosis
################################################
UO:UO_0000036 rdfs:label "year".
snomed:423493009 rdfs:label "Age at diagnosis".

_:AgeDiagnosisShape
    a sh:NodeShape, sio:SIO_000915;
    sh:closed true;
    sh:targetClass snomed:423493009;
    sh:property [
        sh:path rdf:type ;
        sh:hasValue snomed:423493009;
    ];
    sh:property [
        sh:path sio:SIO_000221;
        sh:node _:ageUnit;
    ].
_:ageUnit
    a sh:NodeShape;
    sh:targetClass UO:UO_0000036;
    sh:closed true;
    sh:property [
        sh:path rdf:type ;
        sh:hasValue UO:UO_0000036;
        sh:minCount 1;
    ];
    sh:property [
        sh:path sio:SIO_000300;
        sh:datatype xsd:int ;
        sh:name "Age in years" ;
        sh:minCount 1;
        sh:maxCount 1;
    ].

################################################
# Defining gender
################################################
snomed:365873007 rdfs:label "Gender finding".
snomed:703118005 rdfs:label "Feminine gender".
snomed:703117000 rdfs:label "Masculine gender".

_:GenderShape
    a sh:NodeShape, sio:SIO_000137;
    sh:closed true;
    sh:targetClass snomed:365873007;
    ## This method forces SHACL to mention that only two values are allowed (gender & male, or gender & female)
    sh:xone (
        [
            sh:property [
                sh:path rdf:type;
                sh:hasValue snomed:365873007;
                sh:minCount 2;
                sh:maxCount 2;
            ];
            sh:property [
                sh:path rdf:type;
                sh:hasValue snomed:703117000;
                sh:minCount 2;
                sh:maxCount 2;
            ];
        ] [
            sh:property [
                sh:path rdf:type;
                sh:hasValue snomed:365873007;
                sh:minCount 2;
                sh:maxCount 2;
            ];
            sh:property [
                sh:path rdf:type;
                sh:hasValue snomed:703118005;
                sh:minCount 2;
                sh:maxCount 2;
            ];
        ]
    );
    ## This method forces SHACL to include at minimum 2 out of 3 options for rdf:type
    sh:property [
        sh:path rdf:type ;
        sh:in ( snomed:703117000 snomed:703118005 snomed:365873007) ;
        sh:minCount 2;
    ].